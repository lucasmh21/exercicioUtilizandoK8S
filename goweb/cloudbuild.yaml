substitutions:
  _FIRSTGOWEB_VERSION: 0.0.1

steps:
  - id: "Efetuando testes unit√°rios"
    name: gcr.io/cloud-builders/go
    args: ["test", ".src/main/"]
    env:
      - "GOPATH=./src"
  - id: "Compilando"    
    name: gcr.io/cloud-builders/go
    args: ["CGO_ENABLED=0", "GOOS=linux", "go", "build", "-a", "-installsuffix", "cgo", "-o", "main/src/", "./main/src/"]
    env:
      - "GOPATH=./src"
  - id: "Gerando o container"
    name: gcr.io/cloud-builders/docker
    args: ["build", "-t", "gcr.io/codeeducation-hirao/firstgoweb:${_FIRSTGOWEB_VERSION}", "-t", "gcr.io/codeeducation-hirao/firstgoweb:latest", "."]
images:
  - 'gcr.io/$PROJECT_ID/firstgoweb:latest'
  - 'gcr.io/$PROJECT_ID/firstgoweb:${_FIRSTGOWEB_VERSION}'